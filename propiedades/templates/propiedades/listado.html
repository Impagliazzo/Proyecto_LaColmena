{% extends 'base.html' %}

{% block title %}Propiedades - BuscoTecho{% endblock %}

{% block content %}
<div class="{% if request.GET.especial_estudiantes %}py-8{% else %}bg-gray-50 min-h-screen py-8{% endif %}" {% if request.GET.especial_estudiantes %}style="background: linear-gradient(180deg, #e0e7ff 0%, #c7d2fe 40%, #a78bfa 80%, #8b5cf6 100%); min-height: 100vh;"{% endif %}>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Filtros -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <form method="GET" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-6 gap-4 items-end">
                    <div>
                        {{ form.busqueda }}
                    </div>
                    <div>
                        {{ form.tipo }}
                    </div>
                    <div>
                        {{ form.ciudad }}
                    </div>
                    <div>
                        {{ form.precio_min }}
                    </div>
                    <div>
                        {{ form.precio_max }}
                    </div>
                    <div>
                        <button type="submit" 
                                class="w-full {% if request.GET.especial_estudiantes %}bg-purple-600 hover:bg-purple-700{% else %}bg-yellow-500 hover:bg-yellow-600{% endif %} text-white font-semibold py-2 px-8 rounded-lg transition">
                            <i class="fas fa-search mr-2"></i> Buscar
                        </button>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Filtros rápidos por tipo -->
        {% if not request.GET.especial_estudiantes %}
        <div class="flex overflow-x-auto space-x-4 mb-8 pb-2">
            <a href="{% url 'propiedades:listado' %}" 
               class="flex-shrink-0 px-6 py-3 {% if not request.GET.tipo %}bg-yellow-500 text-white{% else %}bg-white hover:bg-gray-100{% endif %} rounded-lg shadow-md transition text-center font-medium">
                Todas
            </a>
            <a href="{% url 'propiedades:listado' %}?tipo=departamento" 
               class="flex-shrink-0 px-6 py-3 {% if request.GET.tipo == 'departamento' %}bg-blue-500 text-white{% else %}bg-white hover:bg-gray-100{% endif %} rounded-lg shadow-md transition text-center font-medium">
                Departamentos
            </a>
            <a href="{% url 'propiedades:listado' %}?tipo=casa" 
               class="flex-shrink-0 px-6 py-3 {% if request.GET.tipo == 'casa' %}bg-green-500 text-white{% else %}bg-white hover:bg-gray-100{% endif %} rounded-lg shadow-md transition text-center font-medium">
                Casas
            </a>
            <a href="{% url 'propiedades:listado' %}?tipo=cuarto" 
               class="flex-shrink-0 px-6 py-3 {% if request.GET.tipo == 'cuarto' %}bg-purple-500 text-white{% else %}bg-white hover:bg-gray-100{% endif %} rounded-lg shadow-md transition text-center font-medium">
                Cuartos
            </a>
            <a href="{% url 'propiedades:listado' %}?tipo=local" 
               class="flex-shrink-0 px-6 py-3 {% if request.GET.tipo == 'local' %}bg-pink-500 text-white{% else %}bg-white hover:bg-gray-100{% endif %} rounded-lg shadow-md transition text-center font-medium">
                Locales
            </a>
            <a href="{% url 'propiedades:listado' %}?tipo=oficina" 
               class="flex-shrink-0 px-6 py-3 {% if request.GET.tipo == 'oficina' %}bg-orange-500 text-white{% else %}bg-white hover:bg-gray-100{% endif %} rounded-lg shadow-md transition text-center font-medium">
                Oficinas
            </a>
            <a href="{% url 'propiedades:listado' %}?tipo=terreno" 
               class="flex-shrink-0 px-6 py-3 {% if request.GET.tipo == 'terreno' %}bg-yellow-600 text-white{% else %}bg-white hover:bg-gray-100{% endif %} rounded-lg shadow-md transition text-center font-medium">
                Terrenos
            </a>
        </div>
        {% endif %}
        
        <!-- Filtros adicionales -->
        <div class="mb-6 flex items-center justify-between">
            <div>
                <p class="{% if request.GET.especial_estudiantes %}text-gray-800{% else %}text-gray-600{% endif %}">
                    Se encontraron <span class="font-semibold">{{ page_obj.paginator.count }}</span> propiedades
                </p>
            </div>
            <div>
                <button onclick="toggleFiltros()" class="{% if request.GET.especial_estudiantes %}bg-purple-600 hover:bg-purple-700{% else %}bg-yellow-500 hover:bg-yellow-600{% endif %} text-white font-semibold py-2 px-6 rounded-lg transition flex items-center space-x-2">
                    <i class="fas fa-filter"></i>
                    <span>Filtros</span>
                </button>
            </div>
        </div>
        
        <!-- Panel de filtros desplegable -->
        <div id="panel-filtros" class="hidden bg-white rounded-lg shadow-lg p-6 mb-6">
            <form method="GET" id="form-filtros-adicionales">
                {% if request.GET.especial_estudiantes %}
                <input type="hidden" name="especial_estudiantes" value="1">
                {% endif %}
                
                <!-- Espacios -->
                <h3 class="text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">Espacios</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div>
                        <label class="block text-sm text-gray-600 mb-2">
                            <i class="fas fa-bed text-gray-400 mr-1"></i> Habitaciones
                        </label>
                        <select name="habitaciones" id="habitaciones" 
                                class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg {% if request.GET.especial_estudiantes %}focus:border-purple-500 focus:ring-1 focus:ring-purple-500{% else %}focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500{% endif %} transition">
                            <option value="">Cualquiera</option>
                            <option value="1" {% if request.GET.habitaciones == '1' %}selected{% endif %}>1</option>
                            <option value="2" {% if request.GET.habitaciones == '2' %}selected{% endif %}>2</option>
                            <option value="3" {% if request.GET.habitaciones == '3' %}selected{% endif %}>3</option>
                            <option value="4" {% if request.GET.habitaciones == '4' %}selected{% endif %}>Más</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-600 mb-2">
                            <i class="fas fa-bath text-gray-400 mr-1"></i> Baños
                        </label>
                        <select name="banos" id="banos" 
                                class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg {% if request.GET.especial_estudiantes %}focus:border-purple-500 focus:ring-1 focus:ring-purple-500{% else %}focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500{% endif %} transition">
                            <option value="">Cualquiera</option>
                            <option value="1" {% if request.GET.banos == '1' %}selected{% endif %}>1</option>
                            <option value="2" {% if request.GET.banos == '2' %}selected{% endif %}>2</option>
                            <option value="3" {% if request.GET.banos == '3' %}selected{% endif %}>3</option>
                            <option value="4" {% if request.GET.banos == '4' %}selected{% endif %}>Más</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-600 mb-2">
                            <i class="fas fa-ruler-combined text-gray-400 mr-1"></i> Área mínima (m²)
                        </label>
                        <input type="number" name="area_min" id="area_min" value="{{ request.GET.area_min }}"
                               placeholder="50"
                               class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg {% if request.GET.especial_estudiantes %}focus:border-purple-500 focus:ring-1 focus:ring-purple-500{% else %}focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500{% endif %} transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-600 mb-2">
                            <i class="fas fa-ruler-combined text-gray-400 mr-1"></i> Área máxima (m²)
                        </label>
                        <input type="number" name="area_max" id="area_max" value="{{ request.GET.area_max }}"
                               placeholder="200"
                               class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg {% if request.GET.especial_estudiantes %}focus:border-purple-500 focus:ring-1 focus:ring-purple-500{% else %}focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500{% endif %} transition">
                    </div>
                </div>
                
                <!-- Características -->
                <h3 class="text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">Características</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                        <label for="amoblado" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3" title="La propiedad incluye muebles">
                            <i class="fas fa-couch text-gray-400 mr-2 text-sm"></i> Amoblado
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer ml-auto">
                            <input type="checkbox" name="amoblado" id="amoblado" value="1" {% if request.GET.amoblado %}checked{% endif %} class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                        <label for="mascotas" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3" title="Se permiten mascotas en la propiedad">
                            <i class="fas fa-paw text-gray-400 mr-2 text-sm"></i> Mascotas
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer ml-auto">
                            <input type="checkbox" name="mascotas" id="mascotas" value="1" {% if request.GET.mascotas %}checked{% endif %} class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                        <label for="estacionamiento" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3" title="Incluye cochera o espacio para estacionar">
                            <i class="fas fa-car text-gray-400 mr-2 text-sm"></i> Estacionamiento
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer ml-auto">
                            <input type="checkbox" name="estacionamiento" id="estacionamiento" value="1" {% if request.GET.estacionamiento %}checked{% endif %} class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                        <label for="incluye_expensas" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3" title="El precio incluye los gastos comunes del edificio">
                            <i class="fas fa-receipt text-gray-400 mr-2 text-sm"></i> Inc. expensas
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer ml-auto">
                            <input type="checkbox" name="incluye_expensas" id="incluye_expensas" value="1" {% if request.GET.incluye_expensas %}checked{% endif %} class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                        </label>
                    </div>
                </div>
                
                <!-- Comodidades -->
                <h3 class="text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">Comodidades</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                        <label for="balcon" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3" title="Tiene balcón o terraza">
                            <i class="fas fa-door-open text-gray-400 mr-2 text-sm"></i> Balcón
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer ml-auto">
                            <input type="checkbox" name="balcon" id="balcon" value="1" {% if request.GET.balcon %}checked{% endif %} class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                        <label for="patio" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3" title="Tiene patio o jardín">
                            <i class="fas fa-tree text-gray-400 mr-2 text-sm"></i> Patio
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer ml-auto">
                            <input type="checkbox" name="patio" id="patio" value="1" {% if request.GET.patio %}checked{% endif %} class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                        <label for="parrilla" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3" title="Cuenta con parrilla o asador">
                            <i class="fas fa-fire text-gray-400 mr-2 text-sm"></i> Parrilla
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer ml-auto">
                            <input type="checkbox" name="parrilla" id="parrilla" value="1" {% if request.GET.parrilla %}checked{% endif %} class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                        <label for="aire_acondicionado" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3" title="Cuenta con aire acondicionado">
                            <i class="fas fa-snowflake text-gray-400 mr-2 text-sm"></i> Aire acond.
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer ml-auto">
                            <input type="checkbox" name="aire_acondicionado" id="aire_acondicionado" value="1" {% if request.GET.aire_acondicionado %}checked{% endif %} class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                        <label for="calefaccion" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3" title="Cuenta con sistema de calefacción">
                            <i class="fas fa-temperature-high text-gray-400 mr-2 text-sm"></i> Calefacción
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer ml-auto">
                            <input type="checkbox" name="calefaccion" id="calefaccion" value="1" {% if request.GET.calefaccion %}checked{% endif %} class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                        <label for="ascensor" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3" title="El edificio tiene ascensor">
                            <i class="fas fa-elevator text-gray-400 mr-2 text-sm"></i> Ascensor
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer ml-auto">
                            <input type="checkbox" name="ascensor" id="ascensor" value="1" {% if request.GET.ascensor %}checked{% endif %} class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                        </label>
                    </div>
                </div>
                
                <!-- Edificio -->
                <h3 class="text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">Edificio</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                        <label for="seguridad" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3" title="Tiene seguridad privada o portero">
                            <i class="fas fa-shield-alt text-gray-400 mr-2 text-sm"></i> Seguridad
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer ml-auto">
                            <input type="checkbox" name="seguridad" id="seguridad" value="1" {% if request.GET.seguridad %}checked{% endif %} class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                        <label for="amenities" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3" title="Amenities: pileta, gimnasio, salón de usos múltiples, etc.">
                            <i class="fas fa-swimming-pool text-gray-400 mr-2 text-sm"></i> Amenities
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer ml-auto">
                            <input type="checkbox" name="amenities" id="amenities" value="1" {% if request.GET.amenities %}checked{% endif %} class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                        <label for="accesibilidad" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3" title="Apto para personas con movilidad reducida">
                            <i class="fas fa-wheelchair text-gray-400 mr-2 text-sm"></i> Accesibilidad
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer ml-auto">
                            <input type="checkbox" name="accesibilidad" id="accesibilidad" value="1" {% if request.GET.accesibilidad %}checked{% endif %} class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                        </label>
                    </div>
                </div>
                
                <!-- Filtros avanzados -->
                <details class="mb-6">
                    <summary class="text-sm font-semibold text-gray-700 mb-4 cursor-pointer uppercase tracking-wide hover:text-gray-900 flex items-center">
                        Filtros avanzados
                        <i class="fas fa-chevron-down ml-2 text-xs"></i>
                    </summary>
                    <div class="mt-4 pl-1">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                                <label for="tipo_contacto_dueno" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3">
                                    <i class="fas fa-user text-gray-400 mr-2 text-sm"></i> Dueño directo
                                </label>
                                <label class="relative inline-flex items-center cursor-pointer ml-auto">
                                    <input type="radio" name="tipo_contacto" id="tipo_contacto_dueno" value="dueno" {% if request.GET.tipo_contacto == 'dueno' %}checked{% endif %} class="sr-only peer">
                                    <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                                </label>
                            </div>
                            
                            <div class="flex items-center rounded-lg px-3 py-2 transition-colors duration-150 {% if request.GET.especial_estudiantes %}hover:bg-purple-100{% else %}hover:bg-yellow-100{% endif %}">
                                <label for="tipo_contacto_inmobiliaria" class="text-sm text-gray-700 cursor-pointer flex items-center mr-3">
                                    <i class="fas fa-building text-gray-400 mr-2 text-sm"></i> Inmobiliaria
                                </label>
                                <label class="relative inline-flex items-center cursor-pointer ml-auto">
                                    <input type="radio" name="tipo_contacto" id="tipo_contacto_inmobiliaria" value="inmobiliaria" {% if request.GET.tipo_contacto == 'inmobiliaria' %}checked{% endif %} class="sr-only peer">
                                    <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 {% if request.GET.especial_estudiantes %}peer-focus:ring-purple-300{% else %}peer-focus:ring-yellow-300{% endif %} rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all {% if request.GET.especial_estudiantes %}peer-checked:bg-purple-600{% else %}peer-checked:bg-yellow-500{% endif %}"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                </details>
                
                <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
                    <button type="button" onclick="limpiarFiltros()" 
                            class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 text-sm font-medium py-2 px-5 rounded-lg transition">
                        <i class="fas fa-undo mr-1.5 text-xs"></i>Limpiar
                    </button>
                    <button type="submit" 
                            class="{% if request.GET.especial_estudiantes %}bg-purple-600 hover:bg-purple-700{% else %}bg-yellow-500 hover:bg-yellow-600{% endif %} text-white text-sm font-medium py-2 px-5 rounded-lg transition">
                        <i class="fas fa-check mr-1.5 text-xs"></i>Aplicar filtros
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Grid de Propiedades -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            {% for propiedad in page_obj %}
            <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition transform hover:-translate-y-1">
                <div class="relative">
                    <div class="absolute top-4 left-4 flex gap-2 z-10">
                        <span class="{% if propiedad.tipo == 'departamento' %}bg-blue-500{% elif propiedad.tipo == 'casa' %}bg-green-500{% elif propiedad.tipo == 'local' %}bg-purple-500{% elif propiedad.tipo == 'oficina' %}bg-orange-500{% elif propiedad.tipo == 'terreno' %}bg-yellow-600{% else %}bg-pink-500{% endif %} text-white px-3 py-1 rounded-full text-sm font-semibold">
                            {{ propiedad.get_tipo_display }}
                        </span>
                        <span class="bg-yellow-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
                            {% if propiedad.operacion == 'venta' %}En venta{% else %}En alquiler{% endif %}
                        </span>
                    </div>
                    <a href="{% url 'propiedades:detalle' propiedad.pk %}">
                        {% if propiedad.imagen_principal %}
                        <img src="{{ propiedad.imagen_principal.imagen.url }}" 
                             alt="{{ propiedad.titulo }}" 
                             class="w-full h-48 object-cover">
                        {% else %}
                        <div class="w-full h-48 bg-gradient-to-br from-blue-400 to-purple-600 flex items-center justify-center">
                            <i class="fas fa-home text-white text-6xl opacity-50"></i>
                        </div>
                        {% endif %}
                    </a>
                </div>
                
                <div class="p-5">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-2xl font-bold text-gray-900">
                            ${{ propiedad.precio|floatformat:0 }}
                        </h3>
                        {% if user.is_authenticated %}
                        <a href="{% url 'propiedades:toggle_favorito' propiedad.pk %}" 
                           class="text-gray-400 hover:text-red-500 transition">
                            <i class="fas fa-heart"></i>
                        </a>
                        {% endif %}
                    </div>
                    
                    <a href="{% url 'propiedades:detalle' propiedad.pk %}">
                        <h4 class="text-lg font-semibold text-gray-800 mb-2 hover:text-yellow-600 transition">
                            {{ propiedad.get_tipo_display }} en {{ propiedad.ciudad }}
                        </h4>
                    </a>
                    
                    <p class="text-gray-600 text-sm mb-3 flex items-center">
                        <i class="fas fa-map-marker-alt mr-2"></i>
                        {{ propiedad.distrito }}, {{ propiedad.ciudad }}
                    </p>
                    
                    <div class="flex items-center flex-wrap gap-3 text-gray-600 text-sm">
                        <span class="flex items-center">
                            <i class="fas fa-ruler-combined text-yellow-500 mr-1"></i>
                            {{ propiedad.area }}m²
                        </span>
                        <span class="flex items-center">
                            <i class="fas fa-bed text-yellow-500 mr-1"></i>
                            {{ propiedad.habitaciones }}
                        </span>
                        <span class="flex items-center">
                            <i class="fas fa-bath text-yellow-500 mr-1"></i>
                            {{ propiedad.banos }}
                        </span>
                        {% if propiedad.mascotas %}
                        <span class="flex items-center" title="Acepta mascotas">
                            <i class="fas fa-paw text-purple-800 mr-1"></i>
                        </span>
                        {% endif %}
                        {% if propiedad.amoblado %}
                        <span class="flex items-center" title="Amoblado">
                            <i class="fas fa-couch text-green-800 mr-1"></i>
                        </span>
                        {% endif %}
                        {% if propiedad.estacionamiento %}
                        <span class="flex items-center" title="Tiene estacionamiento">
                            <i class="fas fa-car text-blue-800 mr-1"></i>
                        </span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-span-3 text-center py-16">
                <i class="fas fa-search text-gray-300 text-6xl mb-4"></i>
                <p class="text-gray-500 text-lg mb-4">No se encontraron propiedades con los filtros seleccionados</p>
                <a href="{% url 'propiedades:listado' %}" 
                   class="text-yellow-600 hover:text-yellow-700 font-semibold">
                    Ver todas las propiedades
                </a>
            </div>
            {% endfor %}
        </div>
        
        <!-- Paginación -->
        {% if page_obj.has_other_pages %}
        <div class="flex justify-center">
            <nav class="flex space-x-2">
                {% if page_obj.has_previous %}
                <a href="?page=1" 
                   class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                    Primera
                </a>
                <a href="?page={{ page_obj.previous_page_number }}" 
                   class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                    Anterior
                </a>
                {% endif %}
                
                <span class="px-4 py-2 bg-yellow-500 text-white rounded-lg">
                    Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
                </span>
                
                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" 
                   class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                    Siguiente
                </a>
                <a href="?page={{ page_obj.paginator.num_pages }}" 
                   class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                    Última
                </a>
                {% endif %}
            </nav>
        </div>
        {% endif %}
    </div>
</div>

<script>
function toggleFiltros() {
    const panel = document.getElementById('panel-filtros');
    panel.classList.toggle('hidden');
}

function limpiarFiltros() {
    const form = document.getElementById('form-filtros-adicionales');
    const inputs = form.querySelectorAll('input[type="checkbox"]');
    inputs.forEach(input => input.checked = false);
    
    const radios = form.querySelectorAll('input[type="radio"]');
    radios.forEach(radio => radio.checked = false);
    
    const selects = form.querySelectorAll('select');
    selects.forEach(select => select.value = '');
    
    const numbers = form.querySelectorAll('input[type="number"]');
    numbers.forEach(input => input.value = '');
}
</script>

{% endblock %}
