{% extends 'base.html' %}

{% block title %}Suscribirse al {{ plan.nombre }} - BuscoTecho{% endblock %}

{% block content %}
<div class="bg-gray-50 min-h-screen py-16">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            {% if cambio_plan %}
            <!-- Cambio de Plan -->
            <div class="text-center mb-8">
                <i class="fas fa-exchange-alt text-yellow-500 text-5xl mb-4"></i>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Cambiar de Plan</h1>
                <p class="text-gray-600">Estás a punto de cambiar tu suscripción</p>
            </div>
            
            <div class="grid grid-cols-2 gap-6 mb-8">
                <!-- Plan Actual -->
                <div class="border-2 border-gray-300 rounded-lg p-6">
                    <p class="text-sm text-gray-500 mb-2">Plan Actual</p>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">{{ suscripcion_actual.plan.nombre }}</h3>
                    <p class="text-3xl font-bold text-gray-900">S/ {{ suscripcion_actual.plan.precio }}</p>
                    <p class="text-sm text-gray-600">/mes</p>
                    <div class="mt-4 text-sm text-gray-600">
                        <p><i class="fas fa-home mr-2"></i>{{ suscripcion_actual.plan.max_publicaciones }} publicaciones</p>
                    </div>
                </div>
                
                <!-- Nuevo Plan -->
                <div class="border-4 border-yellow-500 rounded-lg p-6 bg-yellow-50">
                    <p class="text-sm text-yellow-700 mb-2 font-semibold">Nuevo Plan</p>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">{{ plan.nombre }}</h3>
                    <p class="text-3xl font-bold text-gray-900">S/ {{ plan.precio }}</p>
                    <p class="text-sm text-gray-600">/mes</p>
                    <div class="mt-4 text-sm text-gray-700">
                        <p><i class="fas fa-home mr-2"></i>{% if plan.max_publicaciones == 999 %}Ilimitadas{% else %}{{ plan.max_publicaciones }}{% endif %} publicaciones</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                <div class="flex">
                    <i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i>
                    <div>
                        <p class="text-sm text-blue-700">
                            <strong>Importante:</strong> Al cambiar de plan, tu suscripción actual será cancelada y se creará una nueva.
                            {% if plan.max_publicaciones > suscripcion_actual.plan.max_publicaciones %}
                            Podrás activar más propiedades automáticamente.
                            {% elif plan.max_publicaciones < suscripcion_actual.plan.max_publicaciones %}
                            Algunas propiedades se suspenderán si excedes el nuevo límite.
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
            
            {% else %}
            <!-- Nueva Suscripción -->
            <div class="text-center mb-8">
                <i class="fas fa-crown text-yellow-500 text-5xl mb-4"></i>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Suscribirse al {{ plan.nombre }}</h1>
                <p class="text-gray-600">{{ plan.descripcion }}</p>
            </div>
            
            <div class="text-center mb-8">
                <p class="text-5xl font-bold text-gray-900">S/ {{ plan.precio }}</p>
                <p class="text-gray-600">/mes</p>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-6 mb-8">
                <h3 class="font-semibold text-gray-900 mb-4">Lo que incluye:</h3>
                <ul class="space-y-2">
                    <li class="flex items-center text-gray-700">
                        <i class="fas fa-check text-green-500 mr-3"></i>
                        <span>{% if plan.max_publicaciones == 999 %}Publicaciones ilimitadas{% else %}Hasta {{ plan.max_publicaciones }} publicaciones activas{% endif %} (+ 1 gratis)</span>
                    </li>
                    <li class="flex items-center text-gray-700">
                        <i class="fas fa-check text-green-500 mr-3"></i>
                        <span>Renovación automática cada {{ plan.duracion_dias }} días</span>
                    </li>
                    {% if plan.destacar_publicaciones %}
                    <li class="flex items-center text-gray-700">
                        <i class="fas fa-star text-yellow-500 mr-3"></i>
                        <span><strong>{{ plan.destacados_incluidos_mes }} Publicaciones destacadas/mes</strong></span>
                    </li>
                    {% endif %}
                    {% if plan.soporte_prioritario %}
                    <li class="flex items-center text-gray-700">
                        <i class="fas fa-headset text-blue-500 mr-3"></i>
                        <span><strong>Soporte prioritario</strong></span>
                    </li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}
            
            <!-- Formulario -->
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
                    <div class="flex">
                        <i class="fas fa-info-circle text-yellow-500 mt-1 mr-3"></i>
                        <div>
                            <p class="text-sm text-yellow-700">
                                <strong>Nota:</strong> Por el momento, el pago se procesa automáticamente para pruebas.
                                Próximamente integraremos pasarela de pagos real.
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-4">
                    <a href="{% url 'suscripciones:planes' %}" 
                       class="flex-1 text-center bg-gray-300 hover:bg-gray-400 text-gray-700 font-semibold py-3 px-6 rounded-lg transition">
                        Cancelar
                    </a>
                    <button type="submit" 
                            class="flex-1 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-semibold py-3 px-6 rounded-lg transition shadow-lg">
                        {% if cambio_plan %}
                            <i class="fas fa-exchange-alt mr-2"></i> Confirmar Cambio
                        {% else %}
                            <i class="fas fa-check-circle mr-2"></i> Confirmar Suscripción
                        {% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
